name: PostgreSQL database
on:
    - push
jobs:
    build:
        runs-on: ubuntu-latest
        services:
            postgres:
                image: postgres
                env:
                    POSTGRES_USER: postgres
                    POSTGRES_PASSWORD: postgres
                    POSTGRES_DB: test-php-lvl3
                ports:
                -   5432:5432
                options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5
        steps:
            -   uses: actions/checkout@v2
            -   uses: actions/setup-node@v2
                with:
                    node-version: '14'
            -   name: Install dependencies
                run: npm ci
            -   name: Connect to PostgreSQL
                # Runs a script that creates a PostgreSQL client, populates
                # the client with data, and retrieves data
                run: node client.js
                # Environment variable used by the `client.js` script to create
                # a new PostgreSQL client.
                env:
                    # The hostname used to communicate with the PostgreSQL service container
                    POSTGRES_HOST: localhost
                    # The default PostgreSQL port
                    POSTGRES_PORT: 5432
            -   name: Run Testsuits
                run: $GITHUB_WORKSPACE/vendor/bin/phpunit tests/Feature --verbose